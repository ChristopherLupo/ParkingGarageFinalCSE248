package com.example.parkinggaragefinalcse248;

import android.content.Context;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

public class MainActivity extends AppCompatActivity {

    public static UserBag bag;
    public static Garage garage;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        load();
        if(garage == null){
            garage = new Garage();
        }
        if(bag == null){
            bag = new UserBag();
            bag.add(new User("Mr.Test","password"));
        }

        final TextView textView = findViewById(R.id.startScreen);
        Button login = findViewById(R.id.login);
        login.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) { setContentView(R.layout.login);
            }
        });

        Button signUp = findViewById(R.id.signUp);
        signUp.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                setContentView(R.layout.sign_up);
            }
        });

//        Button signUpScreen = findViewById(R.id.signupScreen);
//        signUpScreen.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                EditText username = findViewById(R.id.usernameMaker);
//                EditText password = findViewById(R.id.passwordMaker);
//                if(bag.addUser(username.getText().toString(), password.getText().toString())== true){
//                    setContentView(R.layout.garage);
//                    save();
//                }else{
//                    if(username.getText().toString().equals("") || password.getText().toString().equals("")){
//                        TextView signupView = findViewById(R.id.signupView);
//                        signupView.setText("Please fill in both Username and Password");
//                    } else{
//                        TextView signupView = findViewById(R.id.signupView);
//                        signupView.setText("That Username is already in use please use the differnt one");
//                    }
//                }
//            }
//        });


        Button loginScreen = findViewById(R.id.loginScreen);
        loginScreen.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
        }});

//            @Override
//            public void onClick(View v) {
//                EditText username = findViewById(R.id.usernameCheck);
//                EditText password = findViewById(R.id.passwordCheck);
//                if(bag.searchAccount(username.getText().toString(), password.getText().toString())== true){
//                    setContentView(R.layout.garage);
//                }else{
//                    if(username.getText().toString().equals("") || password.getText().toString().equals("")){
//                        TextView signupView = findViewById(R.id.loginView);
//                        signupView.setText("Please fill in both Username and Password");
//                    } else{
//                        TextView signupView = findViewById(R.id.loginView);
//                        signupView.setText("That Username is already in use please use the differnt one");
//                    }
//                }
//            }
//        });

//
//        garage.addCar("HiMom", false);
//        save();

//        Intent intent = getIntent();
//        TextView textView = findViewById(R.id.startScreen);
//
//        ParkingSpot p = g.removePlace("HiMom");
//        Date date = new Date();
//        date.setTime(new Date().getTime() - 3610000);
//
//        p.setDate(date);
//
//       textView.setText(g.price(p) + " "+ new Date().toString() +" "+ p.getDate().toString());
    }

    public void save() {
        String filename = "myfile";
        FileOutputStream outputStream;
        ObjectOutputStream objectOutputStream;

        try { //how to save
            outputStream = openFileOutput(filename, Context.MODE_PRIVATE);
            objectOutputStream = new ObjectOutputStream(outputStream);
            objectOutputStream.writeObject(bag);
            objectOutputStream.writeObject(garage);
            objectOutputStream.flush();
            objectOutputStream.close();
            outputStream.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    public void load(){
        String filename = "myfile";
        FileInputStream inputStream;
        ObjectInputStream objectInputStream;

        try { // how to load
            inputStream = openFileInput(filename);
            objectInputStream = new ObjectInputStream(inputStream);
            bag = (UserBag) objectInputStream.readObject();
            garage = (Garage) objectInputStream.readObject();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
